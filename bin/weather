#!/bin/sh
#----------------------------------------
# Author: Lorenzo Alluminio
# conveniency wrapper for wttr.in
#----------------------------------------

usage() { 
	echo "Usage: $(basename "$0") [-d days] [location]" 1>&2
	echo "shows the weather forecast for $LOCATIONLONG if a location is not specified" 1>&2
	echo "if a location is passed, shows the weather for that location" 1>&2
	echo "-d days, specifies how many days of forecast to show (max. 3, default 2)" 1>&2
	echo "-h, shows this help." 1>&2
}

DAYS=2
while getopts ":d:h" o; do
    case "${o}" in
        d)
	    			DAYS=$OPTARG
            ;;
        h)
            usage
	    			exit 0
            ;;
        *)
            usage
	    			exit 1
            ;;
    esac
done
shift $((OPTIND-1))

# define location
LOCATION=$(echo "$@" | tr " " "+")
if [ -z "$LOCATION" ]; then
	LOCATION="$LOCATIONLONG"
fi

# build query string
QUERY_STRING="${LOCATION}?${DAYS}F"

# perform request
curl -s "https://wttr.in/$QUERY_STRING"
